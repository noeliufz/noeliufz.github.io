<!DOCTYPE html><html lang=zh-TW data-default-color-scheme=auto><head><meta charset=UTF-8><link rel=apple-touch-icon sizes=76x76 href=/img/rainbow.png><link rel=icon href=/img/rainbow.png><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#2f4154><meta name=author content="Fangzhou Liu"><meta name=keywords content=""><meta name=description content="使用xor还是mov $0"><meta property=og:type content=article><meta property=og:title content=寄存器清零的一些发现><meta property=og:url content=https://noeliufz.github.io/2024/05/03/ji-cun-qi-qing-ling-de-yi-xie-fa-xian/index.html><meta property=og:site_name content=小舟的博客><meta property=og:description content="使用xor还是mov $0"><meta property=og:locale content=zh_TW><meta property=og:image content=https://noeliufz.github.io/img/register_clearing/registers.png><meta property=og:image content=https://noeliufz.github.io/img/register_clearing/2024-05-04-151442_hyprshot.png><meta property=article:published_time content=2024-05-03T12:49:10.000Z><meta property=article:modified_time content=2024-12-16T11:15:23.670Z><meta property=article:author content="Fangzhou Liu"><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://noeliufz.github.io/img/register_clearing/registers.png><title>寄存器清零的一些发现 - 小舟的博客</title><link rel=stylesheet href=https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css><link rel=stylesheet href=https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css><link rel=stylesheet href=https://lib.baomitu.com/hint.css/2.7.0/hint.min.css><link rel=stylesheet href=https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css><link rel=stylesheet href=//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css><link rel=stylesheet href=//at.alicdn.com/t/font_1736178_lbnruvf0jn.css><link rel=stylesheet href=/css/main.css><link id=highlight-css rel=stylesheet href=/css/highlight.css><link id=highlight-css-dark rel=stylesheet href=/css/highlight-dark.css><link rel=stylesheet href=/./css/myfont.css><script id=fluid-configs>var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"noeliufz.github.io",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:5},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src=/js/utils.js></script><script src=/js/color-schema.js></script><meta name=generator content="Hexo 6.3.0"></head><body><header><div class=header-inner style=height:70vh><nav id=navbar class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=/ ><strong>小舟的博客</strong> </a><button id=navbar-toggler-btn class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"><div class=animated-icon><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto text-center"><li class=nav-item><a class=nav-link href=/ ><i class="iconfont icon-home-fill"></i> <span>首頁</span></a></li><li class=nav-item><a class=nav-link href=/archives/ ><i class="iconfont icon-archive-fill"></i> <span>歸檔</span></a></li><li class=nav-item><a class=nav-link href=/tags/ ><i class="iconfont icon-tags-fill"></i> <span>標籤</span></a></li><li class=nav-item><a class=nav-link href=/about/ ><i class="iconfont icon-user-fill"></i> <span>關於</span></a></li><li class=nav-item id=search-btn><a class=nav-link target=_self href=javascript:; data-toggle=modal data-target=#modalSearch aria-label=Search><i class="iconfont icon-search"></i></a></li><li class=nav-item id=color-toggle-btn><a class=nav-link target=_self href=javascript:; aria-label="Color Toggle"><i class="iconfont icon-dark" id=color-toggle-icon></i></a></li></ul></div></div></nav><div id=banner class=banner parallax=true style="background:url(/img/bamboo.jpeg) no-repeat center center;background-size:cover"><div class=full-bg-img><div class="mask flex-center" style=background-color:rgba(0,0,0,.3)><div class="banner-text text-center fade-in-up"><div class=h2><span id=subtitle data-typed-text=寄存器清零的一些发现></span></div><div class=mt-3><span class=post-meta><i class="iconfont icon-date-fill" aria-hidden=true></i> <time datetime="2024-05-03 20:49" pubdate>2024年5月3日 晚上</time></span></div><div class=mt-1><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 4.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 18 分鐘</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class=sidebar style=padding-left:2rem;margin-right:-1rem><div id=toc><p class=toc-header><i class="iconfont icon-list"></i> <span>目錄</span></p><div class=toc-body id=toc-body></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id=board-ctn><div id=board><article class="post-content mx-auto"><h1 style=display:none>寄存器清零的一些发现</h1><div class=markdown-body><h1 id=问题起源>问题起源</h1><p>写编译器课的作业到最后instruction selection的部分，在对比使用Compiler explorer的生成的x86_64汇编代码发现一个很神奇的地方就是对寄存器清零（使用立即数0）的方法。</p><p>在创建分支与进行逻辑操作时使用常数0进行比较，我的第一反应是直接使用<code>MOV $0, REG</code>的方法（<code>REG</code>指某一寄存器，下同。），但是发现Compiler explorer会有<code>XOR REG, REG</code>的方法，于是小调研了一下两者的区别。</p><p>首先来看一下英特尔的Software Optimization Manual的3.5.1 Instruction Selection 中第7节Clearing Registers and Dependency Breaking Idioms</p><blockquote><p>Code sequences that modifies partial register can experience some delay in its dependency chain, but can be avoided by using dependency breaking idioms.</p></blockquote><p>在Intel Core micro-architecture中可用下列命令将寄存器置零（亦称dependency breaking idioms或zero idioms）</p><figure class="highlight x86asm"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><code class="hljs x86asm"><span class=hljs-keyword>XOR</span> REG, REG<br><span class=hljs-keyword>SUB</span> REG, REG<br><span class=hljs-keyword>XORPS</span>/PD XMMREG, XMMREG<br><span class=hljs-keyword>PXOR</span> XMMREG, XMMREG<br><span class=hljs-keyword>SUBPS</span>/PD XMMREG, XMMREG<br><span class=hljs-keyword>PSUBB</span>/W/D/Q XMMREG, XMMREG<br></code></pre></td></tr></table></figure><p>然后特别提到</p><blockquote><p>The XOR and SUB instructions can be used to clear execution dependencies on the zero evaluation of the destination register.</p></blockquote><p>之后引出Assembly/Compiler Coding Rule 32</p><blockquote><p>Use dependency-breaking-idiom instructions to set a register to 0, or to break a false dependence chain resulting from re-use of registers. In contexts where the condition codes must be preserved, move 0 into the register instead. This requires more code space than using XOR and SUB, but avoids setting the condition codes.</p></blockquote><p>一开始这些都没明白，但确定了直接使用<code>mov</code>指令和使用其他的指令的两个区别：</p><ol type=1><li><strong><code>MOV</code>指令不会改变ALU的标志位，而<code>XOR</code>和<code>SUB</code>涉及算术运算会更新flag</strong></li><li><strong><code>MOV</code>指令长度相较<code>XOR</code>和<code>SUB</code>指令更长。对于立即数<code>$0</code>至少要额外空间来存下这个数</strong></li></ol><p>之后继续查询相关资料。</p><h1 id=寄存器依赖>寄存器依赖</h1><p>在指令流水线中指令会被分为若干阶段执行，指令可能会不按顺序执行。当同时执行的指令发生冲突会产生危险（hazard）。</p><p>其中有data hazards, structural hazards和control hazards。依赖就是指data之前的依赖关系，当依赖发生问题时就会出现hazard。 这里我们只看data hazards。</p><h2 id=data-hazards>Data hazards</h2><p>有三种。</p><p>read after write (RAW): true dependency</p><p>write after read (WAR): anti-dependency</p><p>write after write (WAW): output dependency</p><h3 id=read-after-write-raw>Read after write (RAW)</h3><figure class="highlight armasm"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs armasm"><span class=hljs-symbol>i1.</span> <span class=hljs-built_in>R2</span> &lt;- <span class=hljs-built_in>R5</span> + <span class=hljs-built_in>R8</span><br><span class=hljs-symbol>i2.</span> <span class=hljs-built_in>R4</span> &lt;- <span class=hljs-built_in>R2</span> + <span class=hljs-built_in>R8</span><br></code></pre></td></tr></table></figure><p>i2如果在i1前执行会对载入的数据有问题，因为R2可能未及时更新。是真正的依赖。</p><h3 id=write-after-read-war>Write after read (WAR)</h3><figure class="highlight armasm"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs armasm"><span class=hljs-symbol>i1.</span> <span class=hljs-built_in>R4</span> &lt;- <span class=hljs-built_in>R1</span> + <span class=hljs-built_in>R5</span><br><span class=hljs-symbol>i2.</span> <span class=hljs-built_in>R5</span> &lt;- <span class=hljs-built_in>R1</span> + <span class=hljs-built_in>R2</span><br></code></pre></td></tr></table></figure><p>i2如果在i1前执行会对R5造成影响。解决方法使用寄存器重新命名，如将i2中的R5改为其他寄存器。最有名的是Tomasulo算法。这一过程发生在硬件级别。</p><h3 id=write-after-write-waw>Write after write (WAW)</h3><figure class="highlight armasm"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs armasm"><span class=hljs-symbol>i1.</span> <span class=hljs-built_in>R5</span> &lt;- <span class=hljs-built_in>R4</span> + <span class=hljs-built_in>R7</span><br><span class=hljs-symbol>i2.</span> <span class=hljs-built_in>R5</span> &lt;- <span class=hljs-built_in>R1</span> + <span class=hljs-built_in>R3</span><br></code></pre></td></tr></table></figure><p>同样可通过寄存器重新命名解决。</p><h1 id=partial-register与假依赖>partial register与假依赖</h1><p>依赖中只有<strong>RAW</strong>是真依赖，<strong>WAR</strong>和<strong>WAW</strong>都是假依赖。</p><p>在x86_64中寄存器可有8位、16位、32位与64位进行访问，详见下表。对于32位寄存器来说，小于等于16位的寄存器被称为partial register。 因为都是一个逻辑寄存器，只是访问大小不同，在操作时可能就会因为这一点出现假依赖的问题。</p><figure><img src=/img/register_clearing/registers.png alt="Register names"><figcaption aria-hidden=true>Register names</figcaption></figure><figure class="highlight x86asm"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><code class="hljs x86asm"><span class=hljs-comment>; Example 9.1c, False dependence of partial register</span><br><span class=hljs-keyword>mov</span> <span class=hljs-built_in>eax</span>, [mem1] <span class=hljs-comment>; 32 bit memory operand</span><br><span class=hljs-keyword>imul</span> <span class=hljs-built_in>eax</span>, <span class=hljs-number>6</span><br><span class=hljs-keyword>mov</span> [mem2], <span class=hljs-built_in>eax</span><br><span class=hljs-keyword>mov</span> <span class=hljs-built_in>ax</span>, [mem3] <span class=hljs-comment>; 16 bit memory operand</span><br><span class=hljs-keyword>add</span> <span class=hljs-built_in>ax</span>, <span class=hljs-number>2</span><br><span class=hljs-keyword>mov</span> [mem4], <span class=hljs-built_in>ax</span><br></code></pre></td></tr></table></figure><p>代码的原本目的是执行两项完全不相关的工作，但是第四条指令<code>mov ax, [mem3]</code>只改变了寄存器的低16位，高16位仍是前面保留下来的结果。 对于Intel, AMD等公司的CPU来说，它们不会对partial register进行重新命名，也就是第四条指令与前面用的是一个物理寄存器，这使得 <code>mov ax, [mem3]</code>依赖于指令<code>imul eax, 6</code>。</p><p>另外有些CPU会对partial register进行重新命名，可以使<code>mov ax, [mem3]</code>不依赖于<code>imul eax, 6</code>，但最后还是要把<code>imul eax, 6</code> 中eax的高16位与<code>mov ax, [mem3]</code>中的ax进行组合，浪费时间。</p><h1 id=zero-idioms-dependency-breaking-idioms>Zero idioms (dependency breaking idioms)</h1><p>在Software Optimization Manual的2.1.3 The Out-of-Order Engine中的Renamer（寄存器重新命名器）也提到了</p><blockquote><p>Instruction parallelism can be improved by using common instructions to clear register contents to zero. The renamer can detect them on the zero evaluation of the destination register. Use one of these dependency breaking idioms to clear a register when possible. Since zero idioms are detected and removed by the renamer, they have no execution latency.</p></blockquote><p>回看第一节中的说法就全明白了。</p><p>对于使用partial register导致的假依赖如果使用zero idioms，CPU中的renamer会自动handle这一情况，对寄存器清零的同时使上下文不再依赖，同时更新ALU的flag，降低运行延时。</p><p>如果在<code>mov ax, [mem3]</code>命令前加上<code>xor eax, eax</code>，会消除因为部分更新导致的依赖。</p><h1 id=验证>验证</h1><p>对于依赖的情况不是很好验证，因为是发生在硬件层面。但对于<strong>指令长度</strong>而言就好验证多了。</p><p>首先尝试在作业的instruction selection上加了特例将<code>const 0</code>的情况使用<code>xor</code>进行处理。然后执行<code>gcc -o a --target=x86_64-apple-macos test.s</code> 看生成的二进制文件大小发现并没有区别。想到我用的是M1芯片的Mac，二进制已经是转成Mac的ARM架构了，而ARM架构指令是定长的与x86_64不太一样不在本文讨论范围，于是转到Arch Linux上 进行实验。</p><p>发现使用两个不同的版本生成的二进制文件大小确实不同，使用<code>xor</code>的文件会更小一些。再用最简单方法进一步验证。</p><p>首先编写了最简单的两段汇编代码。然后使用<code>as mov.s -o mov.o</code>生成<code>.o</code>文件。再使用objdump查看反汇编内容，命令：<code>objdump -s -d mov.o &gt; mov.o.text</code>.</p><p>最终能发现使用<code>mov</code>的机器码确实会比使用<code>xor</code>的要长。单从指令上看<code>mov</code>就要多占用4字节对立即数0（32位）进行存储。</p><figure><img src=/img/register_clearing/2024-05-04-151442_hyprshot.png alt="Screenshot of codes"><figcaption aria-hidden=true>Screenshot of codes</figcaption></figure><h1 id=总结>总结</h1><p>在第一节中介绍的书中的assembly rule会希望大家尽可能使用zero idioms来将寄存器清零。但如果要保持condition的flag则 可以使用<code>mov</code>。最大的影响就是<code>mov</code>指令要引入常数0与12345678这种大数没有区别，指令长度会更长，造成资源浪费。</p><p>另，<code>mov</code>和<code>movq</code>后加立即数读取的是一个32位数字，然后将其扩展到64位（对于操作的寄存器是64位而言）。而<code>movabsq</code>是直接读入一个64位数字。</p><p>(在学不下习的时候什么都比作业好玩)</p><h1 id=references>References</h1><p>[1] - <a target=_blank rel=noopener href=https://stackoverflow.com/questions/58090417/why-does-it-take-less-bytes-to-use-xor-than-to-use-mov>https://stackoverflow.com/questions/58090417/why-does-it-take-less-bytes-to-use-xor-than-to-use-mov</a></p><p>[2] - <a target=_blank rel=noopener href=https://blog.eastonman.com/blog/2021/05/modern-processor/ >https://blog.eastonman.com/blog/2021/05/modern-processor/</a></p><p>[3] - <a target=_blank rel=noopener href=https://www.intel.com/content/dam/doc/manual/64-ia-32-architectures-optimization-manual.pdf>https://www.intel.com/content/dam/doc/manual/64-ia-32-architectures-optimization-manual.pdf</a></p><p>[4] - <a target=_blank rel=noopener href=https://en.wikipedia.org/wiki/Hazard_(computer_architecture)#Data_hazards>https://en.wikipedia.org/wiki/Hazard_(computer_architecture)#Data_hazards</a></p><p>[5] - <a target=_blank rel=noopener href=https://stackoverflow.com/questions/70648350/what-is-false-dependency-in-cpu>https://stackoverflow.com/questions/70648350/what-is-false-dependency-in-cpu</a></p><p>[6] - <a target=_blank rel=noopener href=https://www.cnblogs.com/TaigaCon/p/7455443.html>https://www.cnblogs.com/TaigaCon/p/7455443.html</a></p></div><hr><div><div class="post-metas my-3"></div><div class="license-box my-3"><div class=license-title><div>寄存器清零的一些发现</div><div>https://noeliufz.github.io/2024/05/03/ji-cun-qi-qing-ling-de-yi-xie-fa-xian/</div></div><div class=license-meta><div class=license-meta-item><div>作者</div><div>Fangzhou Liu</div></div><div class="license-meta-item license-meta-date"><div>發布於</div><div>2024年5月3日</div></div><div class=license-meta-item><div>許可協議</div><div><a target=_blank href=https://creativecommons.org/licenses/by/4.0/ ><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href=/2024/05/17/hong-ding-yi-de-shuang-jing-hao/ title=宏定义的双井号><i class="iconfont icon-arrowleft"></i> <span class=hidden-mobile>宏定义的双井号</span> <span class=visible-mobile>上一篇</span></a></article><article class="post-next col-6"><a href=/2024/04/12/la-ding-yu-bi-ji-1/ title="拉丁语笔记 1"><span class=hidden-mobile>拉丁语笔记 1</span> <span class=visible-mobile>下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id=comments><script type=text/javascript>Fluid.utils.loadComments("#comments",function(){var t="github-light",e="dark-blue",s="dark"===(s=document.documentElement.getAttribute("data-user-color-scheme"))?e:t,t=(window.UtterancesThemeLight=t,window.UtterancesThemeDark=e,document.createElement("script"));t.setAttribute("src","https://utteranc.es/client.js"),t.setAttribute("repo","noeliufz/commits-utterances"),t.setAttribute("issue-term","pathname"),t.setAttribute("label","utterances"),t.setAttribute("theme",s),t.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(t)})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"></div></div></div><a id=scroll-top-button aria-label=TOP href=# role=button><i class="iconfont icon-arrowup" aria-hidden=true></i></a><div class="modal fade" id=modalSearch tabindex=-1 role=dialog aria-labelledby=ModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-lg" role=document><div class=modal-content><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜尋</h4><button type=button id=local-search-close class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type=text id=local-search-input class="form-control validate"> <label data-error=x data-success=v for=local-search-input>關鍵字</label></div><div class=list-group id=local-search-result></div></div></div></div></div></main><footer><div class=footer-inner><div class=footer-content><a href=https://hexo.io target=_blank rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href=https://github.com/fluid-dev/hexo-theme-fluid target=_blank rel="nofollow noopener"><span>Fluid</span></a><br><p>封面圖片源自微博博主“不会画画的DFeng”</p></div></div></footer><script src=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js></script><link rel=stylesheet href=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src=https://lib.baomitu.com/jquery/3.6.4/jquery.min.js></script><script src=https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js></script><script src=/js/events.js></script><script src=/js/plugins.js></script><script src=https://lib.baomitu.com/typed.js/2.0.12/typed.min.js></script><script>!function(t){var e=Fluid.plugins.typing,t=t.getElementById("subtitle");t&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src=/js/img-lazyload.js></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src=/js/local-search.js></script><script src=/js/boot.js></script><noscript><div class=noscript-warning>博客在允許 JavaScript 運行的環境下瀏覽效果更佳</div></noscript></body></html>